# Программа для работы с банковскими операциями

## Описание:
    Данное приложение анализирует транзакции, которые находятся в Excel-файле.
    Приложение генерирует JSON-данные для веб-страниц, формирует JSON-отчеты, 
    а также предоставляет другие сервисы.    
---

## Содержание:
* ## <a id="title1">Описание</a>
* ## <a id="title1">Установка</a>
* ## <a id="title1">Использование</a>
* ## <a id="title1">Тестирование</a>
* ## <a id="title1">Команда проекта</a>
* ## <a id="title1">Источники</a>

---

## Установка:
1. #### Клонируйте репозиторий:
```commandline
python
git clone git@github.com:MikhailGubin/banking_applications.git
```

2. #### Установите зависимости:
```commandline
python
pip install -r requirements.txt
```

---

## Использование:

### Веб-страница "События":
#### Описание:
    принимает на вход строку с датой и второй необязательный параметр — диапазон данных. По умолчанию диапазон равен 
    одному месяцу (с начала месяца, на который выпадает дата, по саму дату). Возможные значения второго необязательного 
    параметра:
    W  — неделя, на которую приходится дата;
    M — месяц, на который приходится дата;
    Y — год, на который приходится дата;
    ALL  — все данные до указанной даты.
    Возвращаемый JSON-ответ содержит следующие данные:
    «Расходы»:
    Общая сумма расходов.
    Раздел «Основные», в котором траты по категориям отсортированы по убыванию. Данные предоставляются по 7 категориям с наибольшими тратами, траты по остальным категориям суммируются и попадают в категорию «Остальное».
    Раздел «Переводы и наличные», в котором сумма по категориям «Наличные» и «Переводы» отсортирована по убыванию.
    «Поступления»:
    Общая сумма поступлений.
    Раздел «Основные», в котором поступления по категориям отсортированы по убыванию.
    Курс валют.
    Стоимость акций из S&P 500.    

##### Пример работы функции:
```commandline
python
Пример вызова программы:
    
    pprint.pprint(json.loads(events("25.11.2021 14:33:34", "M"))) 

Результат работы программы:

[{'expenses': 
    {'total_amount': -53700, 
    'main': 
        [{'category': 'ЖКХ', 'amount': 12099}, 
        {'category': 'Супермаркеты', 'amount': 11000}, 
        {'category': 'Медицина', 'amount': 7240}, 
        {'category': 'Каршеринг', 'amount': 6258}, 
        {'category': 'Фастфуд', 'amount': 3566}, 
        {'category': 'Местный транспорт', 'amount': 2712}, 
        {'category': 'Аптеки', 'amount': 2314}, 
        {'category': 'Остальное', 'amount': 8511}], 
    'transfers_and_cash': 
        [{'category': 'Переводы', 'amount': 2000}, 
        {'category': 'Наличные', 'amount': 0}]}, 
'income': 
    {'total_amount': 2896, 
    'main': 
        [{'category': 'Пополнения', 'amount': 200}, 
        {'category': 'Другое', 'amount': 1086}, 
        {'category': 'Бонусы', 'amount': 1610}]}, 
'currency_rates': 
        [{'currency': 'USD', 'rate': 96.92}, 
        {'currency': 'EUR', 'rate': 100.14}], 
'stock_prices': 
        [{'stock': 'AAPL', 'price': 227.71}, 
        {'stock': 'AMZN', 'price': 229.27}]}]

```
#### Сервис "Инвесткопилка":  
##### Описание:
    Позволяет копить через округление трат. Можно задать комфортный порог округления: 10, 50 или 100 ₽. 
    Траты будут округляться, и разница между фактической суммой трат по карте и суммой округления будет 
    попадать на счет «Инвесткопилки».
    Функция возвращает сумму, которую удалось бы отложить в «Инвесткопилку». 
    Функция investment_bank принимает на вход три аргумента:
    month — месяц, для которого рассчитывается отложенная сумма (строка в формате 'YYYY-MM').
    transactions  — список словарей, содержащий информацию о транзакциях, в которых содержатся следующие поля:
        Дата операции — дата, когда произошла транзакция (строка в формате 'YYYY-MM-DD').
        Сумма операции  — сумма транзакции в оригинальной валюте (число).
    limit  — предел, до которого нужно округлять суммы операций (целое число).
     
##### Пример работы функции:
```commandline
python
Пример работы программы:

    month = "2021-11"
    limit = 50
    transactions = get_transactions_for_investment()
    investment_bank(month, transactions, limit) = 5154.96

```

#### Отчёты "Траты по категории" 
##### Описание:
    Функция принимает на вход:
    датафрейм с транзакциями,
    название категории,
    опциональную дату.
    Если дата не передана, то берется текущая дата.
    Функция возвращает траты по заданной категории за последние три месяца (от переданной даты).
    Также функция обернута декоратором, который записывает в файл результат, который возвращает функция, 
    формирующая отчет.
    Декоратор без параметра — записывает данные отчета в файл с названием по умолчанию.
    Декоратор с параметром — принимает имя файла в качестве параметра.

##### Пример работы функции:
```commandline
python
Пример вызова программы:

    df_transactions = read_excel_file(PATH_TO_EXCEL_FILE)
    print(json.loads(spending_by_category(df_transactions, "Госуслуги", "27.12.2021 00:00:00")))
    
Результат работы программы:
[
        {
            "MCC": 9402.0,
            "Бонусы (включая кэшбэк)": 2,
            "Валюта операции": "RUB",
            "Валюта платежа": "RUB",
            "Дата операции": "24.12.2021 20:02:48",
            "Дата платежа": "25.12.2021",
            "Категория": "Госуслуги",
            "Кэшбэк": "0",
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Почта России",
            "Статус": "OK",
            "Сумма операции": -100.2,
            "Сумма операции с округлением": 100.2,
            "Сумма платежа": -100.2,
        },
        {
            "MCC": 9402.0,
            "Бонусы (включая кэшбэк)": 1,
            "Валюта операции": "RUB",
            "Валюта платежа": "RUB",
            "Дата операции": "24.12.2021 19:53:32",
            "Дата платежа": "25.12.2021",
            "Категория": "Госуслуги",
            "Кэшбэк": "0",
            "Номер карты": "*7197",
            "Округление на инвесткопилку": 0,
            "Описание": "Почта России",
            "Статус": "OK",
            "Сумма операции": -78.0,
            "Сумма операции с округлением": 78.0,
            "Сумма платежа": -78.0,
        },
    ]
```
---

## Тестирование:
Код данного проекта покрыт тестами фреймворка pytest более чем на 80 %. 

Для запуска тестов выполните команду:

'''
python
pytest
'''

Чтобы установить pytest через Poetry, используйте команду:

'''
python
poetry add --group dev pytest
'''

Модули с тестами хранятся в директории tests\. 

---

## Команда проекта:
* Губин Михаил — Back-End Engineer

---

## Источники:
* курс лекций и учебных материалов учебного центра "SkyPro"
